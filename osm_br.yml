name: OpenStreetMap e Brezhoneg
description: 'A general-purpose OpenStreetMap mapnik style, focused on minored langages, in CartoCSS'
attribution: 'CC-BY-SA OSM-BZH'
scale: 1
metatile: 2
bounds: &world
  - -180
  - -85
  - 180
  - 85
center:
  - -2.96
  - 48.03
  - 8
format: 'png'
interactivity: false
minzoom: 4
maxzoom: 18
srs: "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over"


_parts:
  # default values used by layers
  extents: &extents
    extent: *world
    srs-name: "3857"
    srs: "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over"
    class: ''
    status: 'on'

  extents84: &extents84
    extent: *world
    srs-name: "WGS84"
    srs: "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"

  osm2pgsql: &osm2pgsql
    type: "postgis"
    dbname: "osm"
    key_field: ""
    geometry_field: "way"
    extent: "-20037508,-20037508,20037508,20037508"
    host: db.openstreetmap.world
    user: osmbr
    password: m4d31nbr31zh
    asynchronous_request: 'true'
    max_async_connection: '4'


# stylesheets
Stylesheet:
  - palette.mss
  - base.mss
  - landcover.mss
  - admin.mss
  - roads.mss
  - labels.mss


# the layers
Layer:

  - id: land_low
    geometry: polygon
    <<: *extents
    Datasource:
      file: /data/styles/data/simplified-land-polygons-complete-3857/simplified_land_polygons.shp
      type: shape
    properties:
      maxzoom: 10


  - id: land_high
    geometry: polygon
    <<: *extents
    Datasource:
      file: /data/styles/data/land-polygons-split-3857/land_polygons.shp
      type: shape


  - id: big_forest
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
          osm_id, way, way_area AS area
        FROM
          planet_osm_polygon
        WHERE
          landuse = 'forest' AND way_area > 5000000
        ) AS big_forest
    properties:
      #polygon-simplify: 10
      #polygon-simplify-algorithm: douglas-peucker
      minzoom: 6
      maxzoom: 9


  - id: landcover_gen0
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
          osm_id, way, way_area AS area, COALESCE(landuse, leisure, "natural", highway, amenity, tourism) AS type
        FROM
          planet_osm_polygon
        WHERE
          way_area > 100000
        ) AS landcover_gen0
    properties:
      #polygon-simplify: 10
      #polygon-simplify-algorithm: douglas-peucker
      minzoom: 9
      maxzoom: 10


  - id: landcover_gen1
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
          osm_id, way, way_area AS area, COALESCE(landuse, leisure, "natural", highway, amenity, tourism) AS type
        FROM
          planet_osm_polygon
        WHERE
          way_area > 10000
        ) AS landcover_gen1
    properties:
      #polygon-simplify: 10
      #polygon-simplify-algorithm: douglas-peucker
      minzoom: 11
      maxzoom: 12


  - id: landcover
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
          osm_id, way, way_area AS area, COALESCE(landuse, leisure, "natural", highway, amenity, tourism) AS type
        FROM
          planet_osm_polygon
        ) AS landcover
    properties:
      #polygon-simplify: 10
      #polygon-simplify-algorithm: douglas-peucker
      minzoom: 12


  - id: aeroway
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
          osm_id, way, aeroway AS type
        FROM
          planet_osm_line
        WHERE
          aeroway IN ('apron', 'runway', 'taxiway')
        ) AS aeroway
    properties:
      minzoom: 10


  - id: waterarea_low
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
          osm_id, way, "natural" AS type, way_area AS area
        FROM
          planet_osm_polygon 
        WHERE
          ("natural" IN ('water', 'pond')
          OR waterway IN ('basin', 'canal', 'mill_pond', 'pond', 'riverbank', 'stream'))
          AND way_area > 75000
          ) AS waterarea_low
    properties:
      minzoom: 7
      maxzoom: 10

  - id: waterarea_med
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
          osm_id, way, "natural" AS type, way_area AS area
        FROM
          planet_osm_polygon 
        WHERE
          ("natural" IN ('water', 'pond')
          OR waterway IN ('basin', 'canal', 'mill_pond', 'pond', 'riverbank', 'stream'))
          AND way_area > 50000
          ) AS waterarea_med
    properties:
      minzoom: 10
      maxzoom: 12

  - id: waterarea
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT 
          osm_id,
          way,
          way_area AS area,
          COALESCE(tags -> 'name:br'::text) as name,
          COALESCE(waterway, '') || COALESCE(landuse, '') || COALESCE("natural", '') as type
        FROM
          planet_osm_polygon
        WHERE 
          waterway IN ('riverbank')
          OR (landuse = ANY (ARRAY['reservoir'::text, 'water'::text, 'basin'::text, 'salt_pond'::text]))
          OR ("natural" = ANY (ARRAY['lake'::text, 'water'::text])) OR amenity = 'swimming_pool'::text
          OR leisure = 'swimming_pool'::text
          ) AS waterarea
    properties:
      minzoom: 12


  - id: waterway_low
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
          osm_id, COALESCE(tags -> 'name:br'::text) as name, COALESCE(waterway, '') as type, way
        FROM
          planet_osm_line
        WHERE
          waterway in ('river','canal')
        ORDER BY z_order
          ) AS waterway_low
    properties:
      minzoom: 8
      maxzoom: 12


  - id: waterway_med
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
          osm_id, COALESCE(tags -> 'name:br'::text) as name, COALESCE(waterway, '') as type, way
        FROM
          planet_osm_line
        WHERE
          waterway in ('stream','river','canal')
        ORDER BY z_order
          ) AS waterway_med
    properties:
      minzoom: 13
      maxzoom: 14

  - id: waterway_high
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
          osm_id, COALESCE(tags -> 'name:br'::text) as name, COALESCE(waterway, '') as type, way
        FROM
          planet_osm_line
        WHERE
          waterway in ('weir','river','canal','derelict_canal','stream','drain','ditch','wadi')
        ORDER BY z_order
          ) AS waterway_high
    properties:
      minzoom: 15




